+ 在微软vs里面如果要写64位的程序，是不支持内联汇编 `__asm` 的。如果要内嵌汇编，需要另外写一个文件。

  ![image-20210306123345094](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210306123345094.png)

+ `rflag` 的高32位全为0，只是为了扩展而扩展成64位。原来32位都还有很多位没有用到

+ ![image-20210306124925842](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210306124925842.png)

  64位系统 ```00007fff`ffffffff~ff8000`00000000``` 的内存地址是没有使用的。其上面是内核空间，下面是用户空间，这样把内核空间和用户空间做一个隔离。

+ 对32位寄存器的写操作，如 `mov eax, 1` 会将相应64位寄存器的 **高32位清零** 。不只是写操作，运算的时候也会影响。比如 `sub eax, 1`  ，也会将64位寄存器的高32位清零。

  + 由于64位汇编的这个特性，我们想要清空 `rax` 的时候也可以使用32位汇编时使用的方法 `xor eax, eax` 。也可以将整个rax寄存器清零。而如果用 `xor rax, rax` 这条指令的话其硬编码会多出一个字节。

    ![image-20210306130230308](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210306130230308.png)

    如果我们要返回一个64位的0，那么编译器生成的代码会是 `xor eax, eax` 。所以看到这条指令的时候不一定代表返回的这个就是一个32位的变量。

    ![image-20210306130618357](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210306130618357.png)

  + 只有操作32位寄存器的时候会将整个64位的寄存器清零。在操作16位的时候并不会有相同的效果。如 `mov ax, 1` 或者 `mov al, 1` 之类的指令并不会影响到 `rax` 其他位上的值。

  + 汇编上看一样的指令硬编码上看不一定一样

    ![image-20210306131453343](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210306131453343.png)

    这个使用到了符号扩展

+ `push` 只能压4个字节，压8个字节的指令不存在，不可以一次压8个字节。如果想要一次压8个字节可以这样

  ![image-20210306132117833](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210306132117833.png)

  先在 `rax` 中倒个手再压到栈里面去。

+ `mov` 指令如果想要 `mov ptr qword ...` 的话，也最多只能移动4个字节。事实上除了直接对寄存器操作，很多操作都不支持8个字节的操作。

+ ![image-20210306132229370](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210306132229370.png)

+ 64位有特别的 `nop`

  ![image-20210306133100972](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210306133100972.png)

  应该是为了内存对齐，直接当其为 `nop` 即可。

+ 在 **正负偏移2GB** 之内的时候， `mov rax, qword ptr ds:[]` 这样的指令后面跟的是一个 **有符号的32位的相对偏移** ，是相对当前指令位置的偏移。而如果正负偏移大于2GB的话，则跟的是一个64位的绝对地址。使用的时候比如如果想读别人的模块的地址，因为距离比较远，所以一半会用到的是第二种，也就是长地址。

  ![image-20210306133701447](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210306133701447.png)