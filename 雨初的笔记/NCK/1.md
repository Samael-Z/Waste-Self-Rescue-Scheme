+ `shift + f12` 加条件断点

  ![image-20201119223255927](https://i.loli.net/2020/11/19/BpDXI2L5QtrxGJR.png)

+ `ctrl + G` 断到特定API

+ `ctrl + f8` 自动步过

+ IDA加参数支持中文

+ 用字符数组可以让IDA和OD都搜不到字符串

  ```c
  char a[] = {0xxx, ... };
  ```

  

  ![image-20210225094441374](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210225094441374.png)

+ 如果在判断的时候新启动了一个线程

  ![image-20210225095947924](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210225095947924.png)

  这样可以找到

  ![image-20210225100004042](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210225100004042.png)

  选择不是红色的，定位到那里，就是关键的位置

+ `local.1` 表示局部变量1

  ![image-20210225101657770](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210225101657770.png)

+ 如果想用vs调试dll，可以这样设置

  ![image-20210307212814384](https://cdn.jsdelivr.net/gh/smallzhong/picgo-pic-bed/image-20210307212814384.png)

+ 如果要通过dll劫持达到目的，而目标exe有壳，那么可以通过

  ```cpp
  while (1)
  {
  	// 判断某个位置的特征码
  	ReadProcessMemory(-1, , ,); // 当然这里可以直接用指针
  }
  ```

  来达到目的，只有解壳完毕之后才跳出循环，执行我们的patch操作。

+ 想要获取线程context可以使用 `GetThreadContext` API。

+ `AddVectoredExceptionHandler` 可以注册一个VEH链

+ 调试器下断就是给第一个字节patch为int3

  ![image-20210325205023217](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210325205023217.png)

+ VS也可以修改字符集

  ![image-20210325210507857](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210325210507857.png)

+ 如果代码节有CRC校验，可以下硬断。想检查是否有类似的代码校验，一个思路是看线程，看哪个线程跑得最欢，然后挂起这个线程。可能就能达到防CRC校验的目的。

+ 易语言里面判断字符串相等可以找 `test edx, 3` 

+ 硬件断点重启不消失，在CPU里面

+ ![image-20210326191214496](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210326191214496.png)

  这个插件有bug，加了硬断之后要重启才能断下来。

+ 如果程序有crc代码校验的话，还有一种思路是hook掉退出函数，如果代码校验线程使用 `exit(0)` 来退出的话直接hook掉不让其退出，应该也是一种方法。

+ ![image-20210326191926426](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210326191926426.png)

+ ![image-20210326192509315](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210326192509315.png)

  可以通过 `GetThreadContext` 获取线程上下文之后修改 `Dr` 寄存器，然后通过 `SetThreadContext` 令其生效，这样设置硬件断点。

+ 白皮书

  ![image-20210326193447105](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210326193447105.png)

+ DR7是调试控制寄存器，DR6决定 `dr0~dr3` 中的断点是什么类型的，是读断点、写断点还是访问断点。

+ ![image-20210326194736130](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210326194736130.png)

  `l0、l1、l2、l3` 分别用来设置 `dr0~dr3` 的断点是否生效。`g0~g3` 也类似，但是 `g0~g3` 设置的是全局的断点，而 `l0~l3` 只是局部的断点，只对当前任务生效。

  ![image-20210326195439607](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210326195439607.png)

+ VM是用来保护函数的，保护代码。

+ `x96dbg` 里面 `alt + e` 可以看到模块。

+ `AddVectoredExceptionHandler` 在xp下面用不了

+ ![image-20210326205136163](C:\Users\雨初\AppData\Roaming\Typora\typora-user-images\image-20210326205136163.png)

  设置硬件断点的时候要挂起了再调用 `SetThreadContext` 。所以要新开启一个线程，挂起主线程，然后通过 `SetThreadContext` 设置硬件断点，再恢复主线程。这样可以让硬件断点的创建不出错。

+ 在通过hook退出函数达到效果的时候，比如 `ExitProcess` 就有两个，一个在 `kernel32` 里面，一个在 `KernelBase` 里面。直接搜的话很可能会跳到 `KernelBase` 里面那个。我们要hook我们想要的那个函数的话可以输入 `kernel32.ExitProcess` 来找到需要hook的那个函数。

+ 加了壳的程序下断点的话重启之后因为代码不一样，会自动帮我们禁用断点。有两种办法，①APIHOOK，②硬断

  + APIHOOK

    ![image-20210326213744363](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210326213744363.png)

    可以在函数正常执行的时候必然执行的API下断。壳子把代码吐出来之后跳转到程序真实OEP，这时候加断点，可以断下来。
  
+ 调试带壳程序，防止断点失效的方法也可以给 `CreateWindowEx` 下断。因为要创建窗口就要调用这个。（A or W?）， `LoadLibrary` 也是同理。

+ ![image-20210327103743794](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327103743794.png)

  可以这样去花

+ `ctrl + f9` 走到函数的返回。

+ IDA对unicode的识别不太智能，要点进去到字符串的地方，然后通过 `alt + a` 设置字符串的类型

  ![image-20210327104542931](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327104542931.png)

  然后选择这个

  ![image-20210327104604675](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327104604675.png)

  即可。返回之后发现没变可以再按一下F5。

+ 不是所有的 `A` 函数都会跳到 `W` 版本的函数上面。最好的办法是两个都下断。

+ OD有执行到用户代码的功能

  ![image-20210327113400464](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327113400464.png)

  不过一般都是在代码节下断。

+ `ctrl + b` 替换，去花的时候可以用， `ctrl + l` 下一个。

+ ![image-20210327121431136](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327121431136.png)

  这样的很可能就是ida识别错了，这时候按y把a2改成char*类型数据，就能正常显示了。

  ![image-20210327121537610](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327121537610.png)

+ 按 `a` 变成字符串。

+ 在逆向的时候遇到了结构体的话，先在结构体窗口添加一个结构体，然后在结构体的第一个元素那里y修改变量类型，修改成结构体，紧跟着的变量就会一并改成结构体了。

+ 全局变量在main之前初始化

+ ![image-20210327141724219](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327141724219.png)

  TLS的addressofindex放了一个函数指针的数组。我们可以把函数放到这里面去。

  ![image-20210327141742855](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327141742855.png)

+ tls函数会在main之前执行。如果od设置断在oep，那么tls反调试就可以让调试器失效。

  ![image-20210327142105534](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327142105534.png)

+ ![image-20210327143333154](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327143333154.png)

+ ![image-20210327145027734](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327145027734.png)

+ `fs:[0]` 是teb， `fs:[0x30]` 是peb。

+ 程序会一直调用tls回调函数。

+ ![image-20210327162543850](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327162543850.png)

  `initterm` 函数用来初始化全局变量。

+ 调试od使用tab键来单步执行（要调出脚本运行窗口）

  ![image-20210327164829400](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327164829400.png)

+ 去花OD脚本

  ![image-20210327165332972](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327165332972.png)

+ ![image-20210327171240825](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327171240825.png)

  这是易语言字符串比较的特征码

+ ![image-20210327182207009](https://cdn.jsdelivr.net/gh/smallzhong/new-picgo-pic-bed@master/image-20210327182207009.png)

+ 要搜特征码最好是在内存窗口中搜。在代码窗口中搜索的话只会搜索当前模块里面的东西。

+ 易语言 `tools/link.ini` 文件用来配置链接器，可以配置易语言的调试信息，将 `extra_args=/DEBUG:FULL` 前面的注释符号去掉，生成的文件就会加上调试信息。

+ 如果想要让别人在消息事件上面下断点没有那么容易，可以在主界面上面加上一个时钟，这样时钟会一直触发消息。想要防止这样的问题可以加条件断点。

+ 易语言里面显示窗口的方法是 `push 窗体id` 然后call一个显示窗体的函数。如果我们把 `push` 的内容改成我们想要加载的窗体，就可以绕过登录的窗体

+ 