### windows64位分页机制分析-隐藏可执行内存方法

+ 之前一直没发过文章，只是一直看文章，这次也想分享一些东西出来。由于本人的水平有限，也是初学者，因此如果有一些错误还望海涵。

+ 在32位系统下，windows有两种分页机制，2-9-9-12分页以及10-10-12分页，而在64位下只有一种分页机制，那就是9-9-9-9-12分页。在64位下，线性地址的结构如下图所示

  ![img](https://raw.githubusercontent.com/smallzhong/new_new_picgo_picbed/main/162118543952835.png)

  在x64体系中，只有48位是用来确定虚拟地址的，前面的16位成为符号拓展位，这16位只有为全1或者为全0两种情况。除了这两种情况之外的地址都是不合法的。这16为为全1时表示这个地址是一个内核空间的地址，而为全0时表示这个地址是一个用户空间的地址。而在windows操作系统中，由于种种原因，又只用了这48位线性地址中的 **44位** 。也就是说windows分配的线性地址前20位都是要么为全0，要么为全1。而CPU没有这个规定。所以我们其实可以找到一块windows永远不会使用，而又合法的线性地址空间。可以利用这块空间做一些事情而不用害怕被分配出去。这里不展开说。

+ 